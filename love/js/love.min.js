"use strict";(function(b,f){b.addEventListener("load",c,false);function c(){var i=null,d=null;(function(){var o=["memphis-colorful.png","envelope-bg.png","postmark.png","stamp.png","magnifier.png","fingerprint.png","notebook.png","qx-text.png","boy.png","girl.png","bridge.png","cloud6.png","cloud7.png","cloud8.png"];var m=0;for(var l=0,j=o.length;l<j;l++){var n="http://sta.ganjistatic1.com/html/test/other/img/"+o[l];var k=new Image();k.addEventListener("load",function(){m++;if(m===j){h(5000)}},false);k.addEventListener("error",function(){h(8000)},false);k.src=n}})();g();function h(j){b.setTimeout(function(){utils.addClass(utils.$(".loading-wrap")[0],"loaded");utils.$(".scene1")[0].style.display="block";clearTimeout(d);b.setTimeout(function(){utils.remove(utils.$(".loading-wrap")[0])},1200)},j)}function g(){f.documentElement.addEventListener("touchstart",a,false);utils.addClass(utils.$(".bubble-fantasy")[0],"bubble-fantasy-scale");i=b.setTimeout(function(){d=b.setInterval(e,300);clearTimeout(i)},2000);(function(){var q=b.location.search.substr(1).split("=");if(q[0]==="love"&&q[1]==="manli"){utils.$(".envelope-front h1")[0].innerHTML="Dear<b></b>Manli";utils.$(".postcodes")[0].innerHTML="<span>5</span><span>2</span><span>0</span>";var r=new XMLHttpRequest();r.open("get","https://ifir.github.io/love/text/text.json",true);r.send(null);r.onreadystatechange=function(){if(r.readyState===4&&r.status===200){var u=JSON.parse(r.responseText);var s=[];for(var t in u){s.push("<p class='notebook-p'>"+u[t]+"</p>")}s.push("<p class='notebook-p' id='qx'>观看七夕小动画<i class='css-movie'></i></p>");utils.$(".scene2")[0].innerHTML=s.join("");utils.$("#qx")[0].addEventListener("touchstart",j,false)}}}})();utils.$(".envelope-front")[0].addEventListener("touchstart",function(){utils.addClass(utils.$(".envelope-wrap")[0],"envelope-wrap-turn");utils.$(".envelope-backmask")[0].addEventListener("touchstart",l,false)},false);function l(){utils.removeClass(utils.$(".envelope-wrap")[0],"envelope-wrap-turn");utils.removeClass(utils.$(".flip")[0],"flip-turn");utils.$(".envelope-open")[0].style.zIndex="8"}utils.$(".open-front")[0].addEventListener("touchstart",p,false);function p(){utils.addClass(utils.$(".flip")[0],"flip-turn");utils.addClass(f.getElementById("letter"),"letter-wrap-animate");b.setTimeout(function(){utils.$(".envelope-open")[0].style.zIndex="3"},400)}utils.$(".open-back")[0].addEventListener("touchstart",k,false);function k(){utils.$(".envelope-open")[0].style.zIndex="8";utils.removeClass(utils.$(".flip")[0],"flip-turn");utils.removeClass(f.getElementById("letter"),"letter-wrap-animate")}var n=f.getElementById("letter");n.addEventListener("touchstart",m,false);function m(){n.style.top="-2.5rem";utils.$(".open-front")[0].removeEventListener("touchstart",p,false);utils.$(".open-back")[0].removeEventListener("touchstart",k,false);utils.$(".envelope-backmask")[0].removeEventListener("touchstart",l,false);b.setTimeout(function(){utils.addClass(n,"open-letter");b.setTimeout(function(){n.addEventListener("touchstart",o,false)},1000)},1000);n.removeEventListener("touchstart",m,false)}function o(){utils.addClass(utils.$(".scene1")[0],"scene-hide");utils.$(".scene2")[0].style.display="block";b.setTimeout(function(){utils.$(".music-control")[0].style.top="-.8rem";utils.remove(utils.$(".scene1")[0])},1200)}utils.$("#qx")[0].addEventListener("touchstart",j,false);function j(){utils.$(".scene3")[0].style.display="block";utils.$(".music-control")[0].style.top="10px";utils.remove(utils.$(".scene2")[0]);b.setTimeout(function(){utils.addClass(utils.$(".scene3")[0],"scale")},10000)}utils.$(".music-control")[0].addEventListener("touchstart",function(){if(utils.hasClass(this,"music-open")){utils.$("#bgm")[0].pause();utils.removeClass(this,"music-open")}else{utils.$("#bgm")[0].play();utils.addClass(this,"music-open")}utils.removeClass(utils.$(".music-control")[0],"delayOpacity");b.setTimeout(function(){utils.addClass(utils.$(".music-control")[0],"delayOpacity")},2000)},false);b.setTimeout(function(){utils.addClass(utils.$(".music-control")[0],"delayOpacity")},2000)}}function a(){utils.$("#bgm")[0].play();utils.addClass(utils.$(".music-control")[0],"music-open");f.documentElement.removeEventListener("touchstart",a)}function e(){var h=utils.$(".icon-food")[0];var d=h.className.split(" ")[1];var g=Math.floor(Math.random()*20);if(d){utils.removeClass(h,d);var i=parseInt(d.split("-")[2],10);if(i===g){if(i===22){g--}else{g++}}}utils.addClass(h,"icon-food-"+g)}})(window,document);